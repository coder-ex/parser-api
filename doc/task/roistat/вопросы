вопросы:
1. https://cloud.roistat.com/api/v1/project/analytics/list-orders?project=39413&key=f5065da2d2fe1ac943f77a5eda2b9ef6
id == roistat_id unsignedBigInteger
status_name == status_name varchar(255)
status_original == status_original varchar(255)
visit->marker == visit_marker varchar(255)
visit->host == visit_host varchar(1000)
creation_date == creation_date varchar(255)|null
update_date == update_date varchar(255)|null
paid_date == paid_date varchar(255)|null
price == price double (15, 4)
cost == cost double (15, 4)
client_id == client_id varchar(50)|null
fields_data->roistat == fields_data_roistat unsignedbiginteger
fields_data->"Менеджер" == field_data_manager varchar(255)
fields_data->"Входящий приоритет" == field_data_in_prior varchar(255)
fields_data->"Рабочий приоритет" == field_data_work_prior varchar(255)
fields_data->"Целевой лид" == field_data_target_lead varchar(255)
fields_data->"Застройщик по договору" == field_data_developer_contract varchar(255)
fields_data->"Дата встречи" == field_data_date_meeting varchar(255)
project_id == один из project, например 39413 unsignedBigInteger

по тем полям которых не будет, проставлять null
$data['orders'][0]['fields_data']['Причина закрытия']

2. https://cloud.roistat.com/api/v1/project/analytics/data?project=39413&key=f5065da2d2fe1ac943f77a5eda2b9ef6
{
    "dimensions": [
        "marker_level_1",
        "marker_level_2",
        "marker_level_3",
        "marker_level_4",
        "marker_level_5",
        "marker_level_6"
    ],
    "metrics": [
        "marketing_cost"
    ],
    "period": {
        "from":" ",
        "to":" "
    },
    "interval": "1d"
}

marketing_cost == items->metrics->value (double)
dateFrom == items->dateFrom (datetime, 3)
dateTo == items->dateTo (datetime, 3)
project_id == project_id (unsigned biginteger)
marker_level_1.title == items->dimensions->marker_level_1->title (varchar(255))
marker_level_2.title == items->dimensions->marker_level_2->title
marker_level_3.title == items->dimensions->marker_level_3->title
marker_level_4.title == items->dimensions->marker_level_4->title
marker_level_5.title == items->dimensions->marker_level_5->title
marker_level_6.title == items->dimensions->marker_level_6->title

показать выгрузки json и excel, если нужно как в excel, то без проблем выборку сделаю нужных полей, если нужны все поля выгрузки, то как вариант json`ы по полям, которые имеют уровни вложения

3. по вопросу 1 уточнение - т.к. по описанию API в настоящее время время метод устарел (см новый /project/integration/order/list), но поддерживается, то в какой то момент времени он перестанет поддерживаться, что будем делать в этом случае
конкретизировать почему именно старый метод используем, по записи говорите про отсутствие даты оплаты в новом эндпоинте, как называется поле даты оплаты в старом эндпоинте ?

--->
@MariyaSergeevnaP я сейчас в БД u1009472_wb_2 в таблицу list_orders залью данные по методу list-orders
период сделаю с 2022-01-01 по текущий день, необходимо проверить соответствие полей, меня интересуют поля:
visit.marker
visit.host
fields_data.roistat
field_data.Менеджер
field_data.Входящий приоритет
field_data.Рабочий приоритет
field_data.Целевой лид
field_data.Застройщик по договору
field_data.Дата встречи

сможете их увидеть или нет ?
минут через 10 думаю зальется все

--->
Мария
приветствую ))
в общем выгрузка за год по методу data занимает очень много времени, даже в локальную БД, на удаленную БД будет занимать еще больше времени, у меня в локальную БД лилось больше часа, но до конца я так и не дождался заливки т.к. несколько раз по столько времени, я просто не смогу до конца доделать ТЗ ))
предлагаю для теста загрузить небольшой период, вы сверите все данные и если все будет нормально, то я сделаю автоподгрузку и начну грузить данные в БД
по методу list_orders нашел причину расхождения дат, на будущее что бы знать, Roistat отдает данные по UTC +0
Марсель находится в часовом поясе с сервером Roistat, поэтому у него такой проблемы не выявлено, у нас с ним разница по времени как раз 3 часа, с мск у него 1 час
как вариант, я скорректирую время выгрузки и напишу вам, что бы сверили
сейчас у меня регламентные работы на ПК проводятся, как доделаю все, сделаю вам контрольные выгрузки по обоим таблицам для сверки, если за выходные сделаете сверку, то к понедельнику попробую доделать автозагрузку данных, нужно будет только уточнить с какого времени начнем грузить в продакшен

--->
1640984400 - from
1641848400 - to
5011200 - diff

--->
@ekatiees опишу новый алгоритм который мы обозначили, пропиши его в ТЗ пожалуйста
1. грузим /project/site/visit/list
2. грузим /project/integration/order/list
3. при обработке п.2 по полю roistat ищем в п.1 id визита:
- если находим то из п.1 поле source->system_name записываем данные в дополнительное поле в п.2 (тут есть проблема, id визита есть, поле source может отсутствовать либо оно есть, но поле system_name пустое)
- если не находим, то значение из п.2 поля roistat переносим в дополнительное поле п.2

обрати внимание на п.3, там есть проблема, напиши что делать в таком случае

---> 2022-09-20
@irmintraud привет, по roistat задача не ординарная, т.е. нам нужно обновлять все полученные нами данные за всю историю каждый день, проблемы этих обновлений я тебе объяснял, т.е. тут два варианта:
1. полное удаление всех таблиц по проектам каждый день и получение полностью новых данных
2. делать добавление новых записей каждый день и затем брать всю историю по сделкам и их обновлять

у каждого варианта есть свои плюсы и минусы, опишу по вариантам:
вариант 1:
а) загрузка данных по каждому проекту с 2017 года происходит в районе 90 минут (по двум таблицам плюс каталог) и это время будет с каждым днем увеличиваться
б) не думаю что у roistat сервера резиновые и в какой то момент они перестанут отдавать слишком старые данные, т.е. у нас история не будет копиться, а будет постоянно обновляться со смещением окна времени
в) если в какой то день у roistat будут перебои с серверами, то данных не будет и таблицы будут пустыми, т.к. перед заливкой новых данных таблицы предварительно очищаются в ноль, а т.к. у нас там три связанные таблицы, то естественно очистка будет происходить по ним по всем сразу
г) исходя из п.(а) на обновление трех проектов каждый день будет уходить около двух часов либо 6 часов (тут нужно будет с тобой переговрить по пересечению данных между проектами)
вариант 2:
а) наш сервер могут заблокировать на roistat, то что они говорят о внесении нашего ip адреса в белый список, не факт, что не попросят за это деньги, т.к. в этом случае мы будем давать ощутимую нагрузку на их сервера
б) дозагрузка новыми данными будет происходить быстро, но обновление через метод GET /project/orders/{orderId}/info будет длиться долго, т.к. можно получать данные только по одной сделке за раз, оптом не отдают жадины )), примерное время обновлений:
- 6 часов по трем проектам (время взял грубым подсчетом, исходя по объему данных в районе 30 000 по таблице roistat_ae_list_integrations по всем проектам)
- плюс непонятно какое обновление нужно будет в таблицу data
```Ограничения по количеству запросов Roistat (кстати сейчас уже наблюдаю изменения в правилах по сравнению с неделей назад)
Ограничения применяются ко всем методам API и действуют для каждого проекта в отдельности.
На данный момент действуют следующие ограничения:
    10 запросов в 1 секунду;
    5000 запросов в 1 час.
Кроме указанных выше правил, других общих ограничений нет. Однако у некоторых методов могут быть дополнительные ограничения. Список этих ограничений (при их наличии) можно найти в описании метода.```
в) по п.(б) время возможно наверное сократить втрое, если не будет пересечения данных между проектами, т.е. запустить каждый проект в отдельном потоке

напиши как все написанное переваришь, можно будет созвониться по zoom если требуется